<!DOCTYPE html>
<html lang="lo">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Print Receipt #{{ order.id }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Lao:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- CSS ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô --- */
        body {
            font-family: 'Noto Sans Lao', sans-serif; /* ‡πÉ‡∏ä‡πâ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏•‡∏≤‡∏ß */
            background-color: #eee;
            margin: 0;
            padding: 20px;
            color: #000;
        }

        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° (‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå) */
        .control-panel {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            font-family: sans-serif; /* ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÉ‡∏ä‡πâ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏õ‡∏Å‡∏ï‡∏¥‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ */
        }
        .control-panel select, .control-panel button {
            padding: 8px 15px;
            font-size: 1em;
            margin: 5px;
            cursor: pointer;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .btn-print { background-color: #28a745; color: white; border: none; font-weight: bold; }
        .btn-print:hover { background-color: #218838; }
        .btn-back { text-decoration: none; color: #666; margin-left: 15px; }

        /* --- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à (Printable Area) --- */
        #printable-area {
            background: #fff;
            margin: 0 auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        /* --- ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ï‡∏≤‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© --- */
        .paper-80mm { max-width: 80mm; padding: 15px; font-size: 14px; }
        .paper-58mm { max-width: 58mm; padding: 10px; font-size: 12px; }
        .paper-58mm h1 { font-size: 1.4em; }
        .paper-a4 { max-width: 210mm; padding: 25mm; font-size: 16px; }
        .paper-a4 h1 { font-size: 2em; }
        .paper-a4 .header, .paper-a4 .info-section { border-bottom-style: solid; }

        /* --- ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à --- */
        .header { text-align: center; margin-bottom: 20px; border-bottom: 1px dashed #000; padding-bottom: 10px; }
        .header h1 { margin: 0; font-weight: normal; } /* ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏•‡∏≤‡∏ß‡∏ö‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ */
        .info-section { margin-bottom: 15px; border-bottom: 1px dashed #ddd; padding-bottom: 10px; }
        .info-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .label { font-weight: bold; }
        
        table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
        th, td { text-align: left; padding: 8px 0; border-bottom: 1px solid #eee; }
        th { font-weight: bold; border-bottom: 2px solid #000; }
        .text-right { text-align: right; }
        
        .totals { margin-top: 15px; border-top: 2px solid #000; padding-top: 10px; }
        .grand-total { font-size: 1.3em; font-weight: bold; }
        .footer { text-align: center; margin-top: 30px; font-size: 0.9em; color: #666; }

        /* --- CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå --- */
        @media print {
            .no-print { display: none !important; }
            body { padding: 0; margin: 0; background: none; }
            #printable-area { box-shadow: none; margin: 0; width: 100%; }
            .paper-80mm, .paper-58mm, .paper-a4 { padding: 0; } 
        }
    </style>
</head>
<body>
    <div class="control-panel no-print">
        <label for="paper-select"><strong>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© (Select Paper Size):</strong></label>
        <br>
        <select id="paper-select" onchange="changePaperSize()">
            <option value="80mm" selected>Thermal Printer (80mm)</option>
            <option value="58mm">Thermal Printer (58mm - Small)</option>
            <option value="a4">Standard Paper (A4)</option>
        </select>
        <br><br>
        <button onclick="window.print()" class="btn-print">üñ®Ô∏è ‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå (Print)</button>
        <a href="{{ url_for('order_detail', order_id=order.id) }}" class="btn-back">‡∏Å‡∏•‡∏±‡∏ö (Back)</a>
    </div>

    <div id="printable-area" class="paper-80mm">
        <div class="header">
            <h1>‡ªÉ‡∫ö‡∫ö‡∫¥‡∫ô‡∫Æ‡∫±‡∫ö‡ªÄ‡∫á‡∫¥‡∫ô (Receipt)</h1>
            <p>My POS System Shop</p>
        </div>

        <div class="info-section">
            <div class="info-row"><span class="label">‡ªÄ‡∫•‡∫Å‡∫ó‡∫µ‡ªÉ‡∫ö‡∫ö‡∫¥‡∫ô:</span> <span>#{{ order.id }}</span></div>
            <div class="info-row"><span class="label">‡∫ß‡∫±‡∫ô‡∫ó‡∫µ:</span> <span>{{ order.order_date.strftime('%d/%m/%Y %H:%M') }}</span></div>
        </div>

        <div class="info-section">
            <strong>‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫•‡∫π‡∫Å‡∫Ñ‡ªâ‡∫≤ (Customer):</strong><br>
            <div class="info-row"><span class="label">‡∫ä‡∫∑‡ªà:</span> <span>{{ order.customer_name or '-' }}</span></div>
            <div class="info-row"><span class="label">‡ªÇ‡∫ó:</span> <span>{{ order.customer_phone or '-' }}</span></div>
            <div style="margin-top: 5px;"><span class="label">‡∫ó‡∫µ‡ªà‡∫¢‡∫π‡ªà:</span><br> {{ order.customer_address or '-' }}</div>
        </div>

        <div class="info-section">
            <strong>‡∫Å‡∫≤‡∫ô‡∫à‡∫±‡∫î‡∫™‡∫ª‡ªà‡∫á (Shipping):</strong><br>
            <div class="info-row">
                <span class="label">‡∫Ç‡∫ª‡∫ô‡∫™‡∫ª‡ªà‡∫á:</span> 
                <span>
                    {% if order.transport_company == '‡∏≠‡∏ô‡∏∏‡∏ä‡∏¥‡∏ï' %} ‡∫≠‡∫∞‡∫ô‡∫∏‡∫ä‡∫¥‡∫î (Anuchit)
                    {% elif order.transport_company == '‡∏°‡∏µ‡πÑ‡∏ä‡∏¢' %} ‡∫°‡∫µ‡ªÑ‡∫ä (Meechai)
                    {% elif order.transport_company == '‡∏£‡∏∏‡πà‡∏á‡∏≠‡∏£‡∏∏‡∏ì' %} ‡∫Æ‡∫∏‡ªà‡∫á‡∫≠‡∫≤‡∫•‡∫∏‡∫ô (Rungarun)
                    {% else %} {{ order.transport_company or '-' }}
                    {% endif %}
                </span>
            </div>
            <div class="info-row"><span class="label">‡∫™‡∫≤‡∫Ç‡∫≤:</span> <span>{{ order.destination_branch or '-' }}</span></div>
            <div class="info-row">
                <span class="label">‡∫ä‡ªç‡∫≤‡∫•‡∫∞:</span> 
                <span>
                {% if order.payment_method == 'COD' %} ‡ªÄ‡∫Å‡∫±‡∫ö‡∫õ‡∫≤‡∫ç‡∫ó‡∫≤‡∫á (COD)
                {% elif order.payment_method == 'Transfer' %} ‡ªÇ‡∫≠‡∫ô‡ªÄ‡∫á‡∫¥‡∫ô‡∫™‡∫ª‡∫î (Transfer)
                {% else %} -
                {% endif %}
                </span>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô (Item)</th>
                    <th class="text-right">‡∫à‡∫ô.</th>
                    <th class="text-right">‡∫•‡∫≤‡∫Ñ‡∫≤</th>
                </tr>
            </thead>
            <tbody>
                {% for item in order.items %}
                    <tr>
                        <td>{{ item.product_name }}</td>
                        <td class="text-right">{{ item.quantity }}</td>
                        <td class="text-right">LAK {{ "{:,.2f}".format(item.quantity * item.price_at_purchase) }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="totals">
            <div class="info-row grand-total">
                <span class="label">‡∫•‡∫ß‡∫°‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î (Total):</span>
                <span>LAK {{ "{:,.2f}".format(order.total_price) }}</span>
            </div>
        </div>

        <div class="footer">
            <p>‡∫Ç‡∫≠‡∫ö‡ªÉ‡∫à‡∫ó‡∫µ‡ªà‡ªÉ‡∫ä‡ªâ‡∫ö‡ªç‡∫•‡∫¥‡∫Å‡∫≤‡∫ô<br>Thank you!</p>
        </div>
    </div>

    <script>
        function changePaperSize() {
            const select = document.getElementById('paper-select');
            const printableArea = document.getElementById('printable-area');
            printableArea.classList.remove('paper-80mm', 'paper-58mm', 'paper-a4');
            printableArea.classList.add('paper-' + selectedSize.value);
        }
    </script>
</body>
</html>